<!doctype html>
<html lang="pt-br" data-bs-theme="dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Login | Projeto E-commerce</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {min-height:100vh;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at center,#0f172a,#0b1220);color:#f1f5f9;font-family:"Segoe UI",sans-serif}
      .auth-card{background:rgba(255,255,255,0.05);backdrop-filter:blur(10px);border-radius:1rem;padding:2rem;box-shadow:0 0 20px rgba(0,0,0,.4);width:100%;max-width:400px}
      .auth-card h1{font-size:1.8rem;margin-bottom:1rem;text-align:center}
      .form-control{background-color:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);color:#fff}
      .form-control:focus{border-color:#38bdf8;box-shadow:0 0 0 .2rem rgba(56,189,248,.25)}
      .btn{border-radius:50px}
      .toggle-link{color:#38bdf8;cursor:pointer}
      .toggle-link:hover{text-decoration:underline}
      .logo{text-align:center;font-size:2.2rem;margin-bottom:1.2rem}
      #msg{min-height:1.25rem}
    </style>
  </head>
  <body>
    <div class="auth-card">
      <div class="logo">üõí</div>
      <h1 id="formTitle">Entrar</h1>

      <form id="formLogin" class="vstack gap-3">
        <input name="email" type="email" class="form-control" placeholder="E-mail" required>
        <input name="password" type="password" class="form-control" placeholder="Senha" required>
        <button class="btn btn-primary w-100">Entrar</button>
      </form>

      <form id="formRegister" class="vstack gap-3 d-none">
        <input name="full_name" type="text" class="form-control" placeholder="Nome completo" required>
        <input name="email" type="email" class="form-control" placeholder="E-mail" required>
        <input name="password" type="password" class="form-control" placeholder="Senha (m√≠nimo 6 caracteres)" minlength="6" required>
        <button class="btn btn-success w-100">Cadastrar</button>
      </form>

      <div class="text-center mt-3 small">
        <span id="toggleText">N√£o tem conta?</span>
        <span class="toggle-link" id="toggleLink">Cadastrar</span>
      </div>

      <div id="msg" class="small text-warning text-center mt-3"></div>

      <hr class="text-secondary mt-4">
      <div class="text-center">
        <a href="/" class="btn btn-outline-light btn-sm">‚¨Ö Voltar</a>
      </div>
    </div>

    <script>
      const formLogin = document.getElementById("formLogin");
      const formRegister = document.getElementById("formRegister");
      const formTitle = document.getElementById("formTitle");
      const toggleText = document.getElementById("toggleText");
      const toggleLink = document.getElementById("toggleLink");
      const msg = document.getElementById("msg");

      toggleLink.addEventListener("click", () => {
        const isLogin = formLogin.classList.contains("d-none");
        formLogin.classList.toggle("d-none");
        formRegister.classList.toggle("d-none");
        formTitle.textContent = isLogin ? "Entrar" : "Cadastrar";
        toggleText.textContent = isLogin ? "N√£o tem conta?" : "J√° tem conta?";
        toggleLink.textContent = isLogin ? "Cadastrar" : "Entrar";
        msg.textContent = "";
      });

      async function postForm(url, data, isForm=false){
        const opts={method:"POST",headers:{}};
        if(isForm){
          opts.headers["Content-Type"]="application/x-www-form-urlencoded";
          const p=new URLSearchParams();Object.entries(data).forEach(([k,v])=>p.append(k,v));
          opts.body=p.toString();
        }else{
          opts.headers["Content-Type"]="application/json";
          opts.body=JSON.stringify(data);
        }
        const res=await fetch(url,opts);
        const body=await res.json().catch(()=>({}));
        if(!res.ok) throw new Error(body.detail||JSON.stringify(body));
        return body;
      }

      formLogin.addEventListener("submit", async (e)=>{
        e.preventDefault(); msg.textContent="Autenticando...";
        try{
          const f=e.target;
          const token=await postForm("/auth/login",{username:f.email.value.trim(),password:f.password.value},true);
          localStorage.setItem("access_token", token.access_token);
          msg.textContent="‚úÖ Login bem-sucedido! Redirecionando...";
          setTimeout(()=>location.href="/static/index.html",700);
        }catch(err){ msg.textContent="‚ùå "+err.message; }
      });

      formRegister.addEventListener("submit", async (e)=>{
        e.preventDefault(); msg.textContent="Criando conta...";
        try{
          const f=e.target;
          await postForm("/auth/register",{full_name:f.full_name.value.trim(),email:f.email.value.trim(),password:f.password.value});
          msg.textContent="‚úÖ Conta criada! Agora fa√ßa login.";
          toggleLink.click();
        }catch(err){ msg.textContent="‚ùå "+err.message; }
      });
    </script>
  </body>
</html>
